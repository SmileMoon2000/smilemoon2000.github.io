function setvalue(t){for(const e in t)$("input#"+e).val(t[e])}function resetWalking(){var t={A:.02,L:5e3,w:1200,E:207,Alpha:1165e-8,pois:.3,t:.0206,r:.162,mu:.5,Theta:2,F_L:100,F_R:300,T_Inital:20,T_End:100,Internal_pressure:30};setvalue(t),myChart.clear()}function linspace(t,e,a){if("number"!=typeof t)return void alert("linspace第1个参数必须为数字");if("number"!=typeof e)return void alert("linspace第2个参数必须为数字");if(a){if(!Number.isInteger(a)||a<1)return void alert("linspace第3个参数必须为正整数")}else a=100;let n=(e-t)/(a-1),s=new Array(a);for(let e=0;e<s.length;e++)s[e]=t+n*e;return s}function zeros(t,e){if("number"!=typeof t||t<1)return void alert("zeros第1个参数必须为正整数");if("number"!=typeof e||e<1)return void alert("zeros第2个参数必须为正整数");let a=new Array(t).fill(0).map(()=>new Array(e).fill(0));return a}function range(t,e){if(!Number.isInteger(t)||!Number.isInteger(e)||t<0||e<0)alert("range参数必须为正整数");else{if(!(t>=e)){var a=Array(e-t+1).fill(0).map((e,a)=>t+a);return a}alert("range第1参数必须小于第2参数")}}function cool_LessThan_XC(t,e,a,n,s,o,r,i,h,c,l,u){let p=(t*Math.cos(e)-Math.sin(e))*a/2/n/s*(l/o)**2,M=(r*i+h/n/s)*l/o,_=(t*Math.cos(e)-Math.sin(e))/8*a/n/s*(1+c)+.5*(r*i+h/n/s);_*=-(1+c);let m=(p+M+_)*o+u;return m}function cool_MoreThan_XC(t,e,a,n,s,o,r,i,h,c,l,u){let p=-(t*Math.cos(e)+Math.sin(e))*a/2/n/s*((o-l)/o)**2,M=-(r*i+h/n/s)*(o-l)/o,_=(t*Math.cos(e)+Math.sin(e))/8*a/n/s*(1-c)+.5*(r*i+h/n/s);return _*=1-c,y=(p+M+_)*o+u,y}function heat_LessThan_XH(t,e,a,n,s,o,r,i,h,c,l,u){let p=-(t*Math.cos(e)+Math.sin(e))*a/2/n/s*(l/o)**2,M=(r*i+h/n/s)*l/o,_=(t*Math.cos(e)+Math.sin(e))/8*a/n/s*(1-c)-.5*(r*i+h/n/s);return _*=1-c,y=(p+M+_)*o+u,y}function heat_MoreThan_XH(t,e,a,n,s,o,r,i,h,c,l,u){let p=((t*Math.cos(e)-Math.sin(e))*a/2/n/s*((o-l)/o)**2-(r*i+h/n/s)*(o-l)/o-(1+c)*((t*Math.cos(e)-Math.sin(e))/8*a/n/s*(1+c)-.5*(r*i+h/n/s)))*o+u;return p}function linspace2(t,e,a,n){var s=linspace(t,e,n),o=linspace(e,a,n),r=s.concat(o);return r}function N_LessThan_XH(t,e,a,n,s,o,r){return-(t*Math.cos(e)+Math.sin(e))*a*n+o}function N_MoreThan_XH(t,e,a,n,s,o,r){return(t*Math.cos(e)-Math.sin(e))*a*(n-s)+r}function N_LessThan_XC(t,e,a,n,s,o,r){return(t*Math.cos(e)-Math.sin(e))*a*n+o}function N_MoreThan_XC(t,e,a,n,s,o,r){return(t*Math.cos(e)+Math.sin(e))*a*(s-n)+r}function strain_LessThan_XH(t,e,a,n,s,o,r,i,h,c,l){return t*e+a/s/o-(r*Math.cos(i)+Math.sin(i))*h*l/s/o/c}function strain_MoreThan_XH(t,e,a,n,s,o,r,i,h,c,l){return t*e+n/s/o-(r*Math.cos(i)-Math.sin(i))*h*(c-l)/s/o/c}function strain_LessThan_XC(t,e,a,n,s,o,r,i,h,c,l){return t*e+a/s/o+(r*Math.cos(i)-Math.sin(i))*h*l/s/o/c}function strain_MoreThan_XC(t,e,a,n,s,o,r,i,h,c,l){return t*e+n/s/o+(r*Math.cos(i)+Math.sin(i))*h*(c-l)/s/o/c}function keypoints_series(t,e,a){var n=linspace(0,t,2*t+1),s=n.map((t,a)=>[t,e.Left[a]]),o=n.map((t,a)=>[t,e.Middle[a]]),r=n.map((t,a)=>[t,e.Right[a]]),i=[{name:"左端"+a,type:"line",showSymbol:!0,emphasis:{focus:"series"},data:s},{name:"中点"+a,type:"line",showSymbol:!0,emphasis:{focus:"series"},data:o},{name:"右端"+a,type:"line",showSymbol:!0,emphasis:{focus:"series"},data:r}];return i}function Echart_Option(t,e,a,n,s){if(s.length&&s.length>1){var o=s.length/2,r=(Array(2*o).fill("").map((t,e)=>e<o?"red":"blue"),[]);s.forEach(t=>{r.push(t.name)})}var i={title:{text:e},backgroundColor:"#fff",tooltip:{trigger:"axis",textStyle:{fontSize:10},valueFormatter:t=>t.toFixed(5),backgroundColor:"rgba(250,250,250,0.3)"},grid:{left:20,right:50,bottom:20,containLabel:!0},toolbox:{feature:{mark:{show:!0},dataView:{show:!0},restore:{show:!0},dataZoom:{show:!0},saveAsImage:{show:!0},myFull:{show:!0,title:"全屏",icon:"path://M128 32H32C14.31 32 0 46.31 0 64v96c0 17.69 14.31 32 32 32s32-14.31 32-32V96h64c17.69 0 32-14.31 32-32S145.7 32 128 32zM416 32h-96c-17.69 0-32 14.31-32 32s14.31 32 32 32h64v64c0 17.69 14.31 32 32 32s32-14.31 32-32V64C448 46.31 433.7 32 416 32zM128 416H64v-64c0-17.69-14.31-32-32-32s-32 14.31-32 32v96c0 17.69 14.31 32 32 32h96c17.69 0 32-14.31 32-32S145.7 416 128 416zM416 320c-17.69 0-32 14.31-32 32v64h-64c-17.69 0-32 14.31-32 32s14.31 32 32 32h96c17.69 0 32-14.31 32-32v-96C448 334.3 433.7 320 416 320z",onclick:(t,e)=>{t.target;var a=this.event.target.closest(".echart").id;const n=document.getElementById(a);n.requestFullScreen?n.requestFullScreen():n.msRequestFullscreen?n.msRequestFullScreen():n.webkitRequestFullScreen?n.webkitRequestFullScreen():n.mozRequestFullScreen&&n.mozRequestFullScreen(),n.requestFullScreen?document.exitFullscreen():n.msRequestFullScreen?document.msExitFullscreen():n.webkitRequestFullScreen?document.webkitCancelFullScreen():n.mozRequestFullScreen&&document.mozCancelFullScreen()}}}},xAxis:{type:"value",name:a,splitLine:{show:!0},boundaryGap:!1},yAxis:{type:"value",lineStyle:{width:1},name:n},series:s};return i}function calculateFirstPhase(){let t=$("div.card-input input[type=number]"),e=[];t.each((t,a)=>{e[$(a).attr("id")]=Number($(a).val())});const a=e.theta*(Math.PI/180),n=e.mu,s=e.delta_e,o=1e-5*e.alpha,r=e.T,i=e.T_c,h=e.w,c=e.L,l=1e9*e.E,u=e.A,p=e.Ft,M=e.Fb,_=e.c1,m=e.c2,d=e.x_Ho,f=e.x_Hi,x=e.x1,y=e.x2,g=e.x3;let C=[_,m,d,f];const H=n*h*Math.cos(a)/s,w=Math.sqrt(l*u/H),b=p/(l*u),L=M/(l*u),v=(n*h*Math.cos(a)+h*Math.sin(a))*c/(l*u),F=(n*h*Math.cos(a)-h*Math.sin(a))*c/(l*u),E=1e-6,k=1e3;let T=!1,O=0,S={Left:[0],Middle:[0],Right:[0]};for(let t=1;t<=k;t++){const[e,n,i,l]=C,u=e*Math.exp(i/w)+n*Math.exp(-i/w)+h*Math.sin(a)/H+s,p=e*Math.exp(l/w)+n*Math.exp(-l/w)+h*Math.sin(a)/H-s,M=e/w*Math.exp(i/w)-n/w*Math.exp(-i/w)-o*r+v*(i/c+.5)-b,_=e/w*Math.exp(l/w)-n/w*Math.exp(-l/w)-o*r-F*(l/c-.5)-L,m=[u,p,M,_];if(Math.sqrt(m.reduce((t,e)=>t+e*e,0))<E){console.log(`收敛于第 ${t} 次迭代`),T=!0,O=t;break}const d=[[Math.exp(i/w),Math.exp(-i/w),e/w*Math.exp(i/w)-n/w*Math.exp(-i/w),0],[Math.exp(l/w),Math.exp(-l/w),0,e/w*Math.exp(l/w)-n/w*Math.exp(-l/w)],[1/w*Math.exp(i/w),-1/w*Math.exp(-i/w),e/w**2*Math.exp(i/w)+n/w**2*Math.exp(-i/w)+v/c,0],[1/w*Math.exp(l/w),-1/w*Math.exp(-l/w),0,e/w**2*Math.exp(l/w)+n/w**2*Math.exp(-l/w)-F/c]],f=solveLinearSystem(d,m.map(t=>-t));C=C.map((t,e)=>t+f[e]),console.log(`第 ${t} 次迭代: c1 = ${C[0]}, c2 = ${C[1]}, x_Ho = ${C[2]}, x_Hi = ${C[3]}`)}if(!T){const t=document.getElementById("first-phase-result");t.innerHTML=`\n            <h2 style="color: red">计算未收敛</h2>\n            <pre>经过 ${k} 次迭代仍未达到收敛条件\n请尝试:\n            1. 增加最大迭代次数\n            2. 调整初始猜测值\n            3. 检查输入参数合理性\n            </pre> `,firstPhaseConverged=!1;const e=document.getElementById("second-phase-result");return void(e.innerHTML='\n                <h2 style="color: red">警告</h2>\n                <pre>第一阶段计算结果未收敛，无法进行第二阶段计算！</pre>')}firstPhaseConverged=!0,console.log("最终解:"),console.log(`c1 = ${C[0]}`),console.log(`c2 = ${C[1]}`),console.log(`x_Ho = ${C[2]}`),console.log(`x_Hi = ${C[3]}`);const R=-v*(x**2-C[2]**2)/(2*c)+(o*r-v/2+b)*(x-C[2])-s,q=F*(y**2-C[3]**2)/(2*c)+(o*r-F/2+L)*(y-C[3])+s,N=F*(g**2-C[3]**2)/(2*c)+(o*r-F/2+L)*(g-C[3])+s;console.log(`u_H1 = ${R}`),console.log(`u_H2 = ${q}`),console.log(`u_H3 = ${N}`),S.Left.push(R),S.Middle.push(q),S.Right.push(N);const P=document.getElementById("first-phase-result");P&&(P.innerHTML=`\n\t\t\t<h2>第一阶段计算结果(单位: m)</h2>\n\t\t\t<pre>\n\t\t\t收敛于第 ${O} 次迭代\n\n\t\t\t第1次循环加热最终解:\n\t\t\tc1 = ${C[0]}\n\t\t\tc2 = ${C[1]}\n\t\t\tx_Ho = ${C[2]}\n\t\t\tx_Hi = ${C[3]}\n\n\t\t\t第1次循环加热位移结果:\n\t\t\tu_H1 = ${R.toFixed(8)}\n\t\t\tu_H2 = ${q.toFixed(8)}\n\t\t\tu_H3 = ${N.toFixed(8)}\n\t\t\t</pre> `),firstPhaseResults={c1:C[0],c2:C[1],x_Ho:C[2],x_Hi:C[3],u_H1:R,u_H2:q,u_H3:N,theta:a,mu:n,delta_e:s,alpha:o,T:r,T_c:i,w:h,L:c,E:l,A:u,Ft:p,Fb:M,x1:x,x2:y,x3:g,keypointdisps:S},calculateSecondPhase(firstPhaseResults)}function calculateSecondPhase(t){if(!t||!firstPhaseConverged){const t=document.getElementById("second-phase-result");return void(t&&(t.innerHTML='\n            <h2 style="color: red">警告</h2>\n            <pre>第一阶段计算结果未收敛，请检查输入参数或调整初始值！</pre>'))}const{c1:e,c2:a,x_Ho:n,x_Hi:s,u_H1:o,u_H2:r,u_H3:i,theta:h,mu:c,delta_e:l,alpha:u,T:p,T_c:M,w:_,L:m,E:d,A:f,Ft:x,Fb:y,x1:g,x2:C,x3:H,keypointdisps:w}=t,b=c*_*Math.cos(h)/l,L=Math.sqrt(d*f/b),v=x/(d*f),F=y/(d*f),E=(c*_*Math.cos(h)+_*Math.sin(h))*m/(d*f),k=(c*_*Math.cos(h)-_*Math.sin(h))*m/(d*f),T=_*m*Math.sin(h)+y-x,O=c*_*m*Math.cos(h)/(d*f),S=(c*_*m*Math.cos(h)-T)/(d*f),R=[],q=5,N={x1:g,x2:C,x3:H,lambda:L,alpha:u,T_c:M,omega:O,omega_plus:E,omega_minus:k,ft:v,fb:F,delta_e:l,L:m,R:S,T:p};let P={x_Ho:n,x_Hi:s,u_Cho:0,u_Chi:l,u_H1:o,u_H2:r,u_H3:i,phase:"第1次循环加热",type:"heating"},z=calculateCoolingPhase(N,P,phaseNumber=1);R.push(z),w.Left.push(z.u_C1),w.Middle.push(z.u_C2),w.Right.push(z.u_C3);for(let t=2;t<=q;t++)P=calculateHeatingPhase(N,z,phaseNumber=t),R.push(P),w.Left.push(o),w.Middle.push(r),w.Right.push(i),z=calculateCoolingPhase(N,P,phaseNumber=t),R.push(z),w.Left.push(z.u_C1),w.Middle.push(z.u_C2),w.Right.push(z.u_C3);displayPhaseResults(R);var A=keypoints_series(q,w,"位移");EchartOptionList.keypointdisp=Echart_Option("echart_walking","关键点位移","循环数","位移(m)",A),$("select#echart").change()}function calculateCoolingPhase(t,e,a){const{x1:n,x2:s,x3:o,lambda:r,alpha:i,T_c:h,omega:c,omega_plus:l,omega_minus:u,ft:p,fb:M,delta_e:_,L:m,R:d,T:f}=t,{x_Ho:x,x_Hi:y,u_Cho:g,u_Chi:C,u_H1:H,u_H2:w,u_H3:b,phase:L,type:v}=e,$=.5*m*(1-i*f/c+1/c*Math.sqrt(Math.pow(2*_/r,2)+Math.pow(i*f-d,2))),F=$-r*Math.log(Math.sqrt(Math.pow(2*_/(r*(i*f-d)),2)+1)+2*_/(r*(i*f-d))),E=(Math.exp(-F/r),Math.exp(F/r),u*(Math.pow(F,2)-Math.pow(y,2))/(2*m)+(i*f-u/2+M)*(F-y)+C),k=u*(Math.pow($,2)-Math.pow(y,2))/(2*m)+(i*f-u/2+M)*($-y)+C,T=u/(2*m)*(Math.pow(n,2)-Math.pow(F,2))+(i*h+u/2+p)*(n-F)+E,O=u/(2*m)*(Math.pow(s,2)-Math.pow(F,2))+(i*h+u/2+p)*(s-F)+E,S=-l/(2*m)*(Math.pow(o,2)-Math.pow($,2))+(i*h+l/2+M)*(o-$)+k-2*_;return{x_Co:$,x_Ci:F,u_Hci:E,u_Hco:k,u_C1:T,u_C2:O,u_C3:S,phase:`第${a}次循环冷却`,type:"cooling"}}function calculateHeatingPhase(t,e,a){const{x1:n,x2:s,x3:o,lambda:r,alpha:i,T_c:h,omega:c,omega_plus:l,omega_minus:u,ft:p,fb:M,delta_e:_,L:m,R:d,T:f}=t,{x_Co:x,x_Ci:y,u_Hci:g,u_Hco:C,u_C1:H,u_C2:w,u_C3:b,phase:L,type:v}=e,$=.5*-m*(1-i*f/c+1/c*Math.sqrt(Math.pow(2*_/r,2)+Math.pow(i*f-d,2))),F=$+r*Math.log(Math.sqrt(Math.pow(2*_/(r*(i*f-d)),2)+1)+2*_/(r*(i*f-d))),E=(Math.exp(-F/r),Math.exp(F/r),u/(2*m)*(Math.pow($,2)-Math.pow(y,2))+(i*h+u/2+p)*($-y)+g),k=u/(2*m)*(Math.pow(F,2)-Math.pow(y,2))+(i*h+u/2+p)*(F-y)+g,T=-l/(2*m)*(Math.pow(n,2)-Math.pow($,2))+(i*f-l/2+p)*(n-$)+E-2*_,O=u/(2*m)*(Math.pow(s,2)-Math.pow(F,2))+(i*f-u/2+M)*(s-F)+k,S=u/(2*m)*(Math.pow(o,2)-Math.pow(F,2))+(i*f-u/2+M)*(o-F)+k;return{x_Ho:$,x_Hi:F,u_Cho:E,u_Chi:k,u_H1:T,u_H2:O,u_H3:S,phase:`第${a}次循环加热`,type:"heating"}}function displayPhaseResults(t){let e="<h2>第二阶段计算结果(单位: m)</h2><pre>";t.forEach(t=>{e+=`\n${t.phase}位移结果:\n`,"heating"===t.type?(e+=`u_H1 = ${t.u_H1.toFixed(8)}\n`,e+=`u_H2 = ${t.u_H2.toFixed(8)}\n`,e+=`u_H3 = ${t.u_H3.toFixed(8)}\n`):(e+=`u_C1 = ${t.u_C1.toFixed(8)}\n`,e+=`u_C2 = ${t.u_C2.toFixed(8)}\n`,e+=`u_C3 = ${t.u_C3.toFixed(8)}\n`)}),e+="</pre>";const a=document.getElementById("second-phase-result");a&&(a.innerHTML=e)}function solveLinearSystem(t,e){const a=t.length;for(let n=0;n<a;n++){let s=n;for(let e=n+1;e<a;e++)Math.abs(t[e][n])>Math.abs(t[s][n])&&(s=e);[t[n],t[s]]=[t[s],t[n]],[e[n],e[s]]=[e[s],e[n]];for(let s=n+1;s<a;s++){const o=t[s][n]/t[n][n];e[s]-=o*e[n];for(let e=n;e<a;e++)t[s][e]-=o*t[n][e]}}const n=new Array(a).fill(0);for(let s=a-1;s>=0;s--){n[s]=e[s]/t[s][s];for(let a=s-1;a>=0;a--)e[a]-=t[a][s]*n[s]}return n}var ECharts=[],EchartOptionList=[],myChart=echarts.init(document.getElementById("echart_walking"));$("select#echart").on("change",function(t){switch(t.target.value){case"resistancesoil":EchartOptionList.resistancesoil&&(myChart.clear(),myChart.setOption(EchartOptionList.resistancesoil));break;case"N":EchartOptionList.N&&(myChart.clear(),myChart.setOption(EchartOptionList.N));break;case"strain":EchartOptionList.strain&&(myChart.clear(),myChart.setOption(EchartOptionList.strain));break;case"disp":EchartOptionList.disp&&(myChart.clear(),myChart.setOption(EchartOptionList.disp));break;case"keypointdisp":EchartOptionList.keypointdisp&&(myChart.clear(),myChart.setOption(EchartOptionList.keypointdisp));break;case"keypointN":EchartOptionList.keypointN&&(myChart.clear(),myChart.setOption(EchartOptionList.keypointN));break;case"keypointstrain":EchartOptionList.keypointstrain&&(myChart.clear(),myChart.setOption(EchartOptionList.keypointstrain))}}),$(window).resize(t=>{myChart.resize()});