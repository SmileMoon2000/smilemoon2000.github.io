function setvalue(t){for(const e in t)$("input#"+e).val(t[e])}function resetInputs(){var t={theta:2,mu:.5,nu:.3,delta_e:.1,alpha:1.165,T:100,T_c:0,w:1200,L:5e3,E:207,A:.02,Ft:1e5,Fb:3e5,c1:-1.0079,c2:.5263,x_Ho:-509,x_Hi:-323,x1:-2500,x2:0,x3:2500};setvalue(t),myChart.clear()}function linspace(t,e,a){if("number"!=typeof t)return void alert("linspace第1个参数必须为数字");if("number"!=typeof e)return void alert("linspace第2个参数必须为数字");if(a){if(!Number.isInteger(a)||a<1)return void alert("linspace第3个参数必须为正整数")}else a=100;let n=(e-t)/(a-1),s=new Array(a);for(let e=0;e<s.length;e++)s[e]=t+n*e;return s}function zeros(t,e){if("number"!=typeof t||t<1)return void alert("zeros第1个参数必须为正整数");if("number"!=typeof e||e<1)return void alert("zeros第2个参数必须为正整数");let a=new Array(t).fill(0).map(()=>new Array(e).fill(0));return a}function range(t,e){if(!Number.isInteger(t)||!Number.isInteger(e)||t<0||e<0)alert("range参数必须为正整数");else{if(!(t>=e)){var a=Array(e-t+1).fill(0).map((e,a)=>t+a);return a}alert("range第1参数必须小于第2参数")}}function keypoints_series(t,e,a){var n=linspace(0,t,2*t+1),s=n.map((t,a)=>[t,e.Left[a]]),o=n.map((t,a)=>[t,e.Middle[a]]),r=n.map((t,a)=>[t,e.Right[a]]),i=[{name:"左端"+a,type:"line",showSymbol:!0,emphasis:{focus:"series"},data:s},{name:"中点"+a,type:"line",showSymbol:!0,emphasis:{focus:"series"},data:o},{name:"右端"+a,type:"line",showSymbol:!0,emphasis:{focus:"series"},data:r}];return i}function Echart_Option(t,e,a,n,s){if(s.length&&s.length>1){var o=s.length/2,r=(Array(2*o).fill("").map((t,e)=>e<o?"red":"blue"),[]);s.forEach(t=>{r.push(t.name)})}var i={title:{text:e},backgroundColor:"#fff",tooltip:{trigger:"axis",textStyle:{fontSize:10},valueFormatter:t=>t.toFixed(5),backgroundColor:"rgba(250,250,250,0.3)"},grid:{left:20,right:50,bottom:20,containLabel:!0},toolbox:{feature:{mark:{show:!0},dataView:{show:!0},restore:{show:!0},dataZoom:{show:!0},saveAsImage:{show:!0},myFull:{show:!0,title:"全屏",icon:"path://M128 32H32C14.31 32 0 46.31 0 64v96c0 17.69 14.31 32 32 32s32-14.31 32-32V96h64c17.69 0 32-14.31 32-32S145.7 32 128 32zM416 32h-96c-17.69 0-32 14.31-32 32s14.31 32 32 32h64v64c0 17.69 14.31 32 32 32s32-14.31 32-32V64C448 46.31 433.7 32 416 32zM128 416H64v-64c0-17.69-14.31-32-32-32s-32 14.31-32 32v96c0 17.69 14.31 32 32 32h96c17.69 0 32-14.31 32-32S145.7 416 128 416zM416 320c-17.69 0-32 14.31-32 32v64h-64c-17.69 0-32 14.31-32 32s14.31 32 32 32h96c17.69 0 32-14.31 32-32v-96C448 334.3 433.7 320 416 320z",onclick:(t,e)=>{t.target;var a=this.event.target.closest(".echart").id;const n=document.getElementById(a);n.requestFullScreen?n.requestFullScreen():n.msRequestFullscreen?n.msRequestFullScreen():n.webkitRequestFullScreen?n.webkitRequestFullScreen():n.mozRequestFullScreen&&n.mozRequestFullScreen(),n.requestFullScreen?document.exitFullscreen():n.msRequestFullScreen?document.msExitFullscreen():n.webkitRequestFullScreen?document.webkitCancelFullScreen():n.mozRequestFullScreen&&document.mozCancelFullScreen()}}}},xAxis:{type:"value",name:a,splitLine:{show:!0},boundaryGap:!1},yAxis:{type:"value",lineStyle:{width:1},name:n},series:s};return i}function calculateFirstPhase(){let t=$("div.card-input input[type=number]"),e=[];t.each((t,a)=>{e[$(a).attr("id")]=Number($(a).val())});const a=e.theta*(Math.PI/180),n=e.mu,s=e.delta_e,o=1e-5*e.alpha,r=e.T,i=e.T_c,h=e.w,l=e.L,c=1e9*e.E,u=e.A,p=e.Ft,m=e.Fb,_=e.c1,d=e.c2,M=e.x_Ho,x=e.x_Hi,f=e.x1,y=e.x2,g=e.x3;let H=[_,d,M,x];const C=n*h*Math.cos(a)/s,w=Math.sqrt(c*u/C),b=p/(c*u),L=m/(c*u),v=(n*h*Math.cos(a)+h*Math.sin(a))*l/(c*u),F=(n*h*Math.cos(a)-h*Math.sin(a))*l/(c*u),E=1e-6,k=1e3;let O=!1,S=0,R={Left:[0],Middle:[0],Right:[0]};for(let t=1;t<=k;t++){const[e,n,i,c]=H,u=e*Math.exp(i/w)+n*Math.exp(-i/w)+h*Math.sin(a)/C+s,p=e*Math.exp(c/w)+n*Math.exp(-c/w)+h*Math.sin(a)/C-s,m=e/w*Math.exp(i/w)-n/w*Math.exp(-i/w)-o*r+v*(i/l+.5)-b,_=e/w*Math.exp(c/w)-n/w*Math.exp(-c/w)-o*r-F*(c/l-.5)-L,d=[u,p,m,_];if(Math.sqrt(d.reduce((t,e)=>t+e*e,0))<E){console.log(`收敛于第 ${t} 次迭代`),O=!0,S=t;break}const M=[[Math.exp(i/w),Math.exp(-i/w),e/w*Math.exp(i/w)-n/w*Math.exp(-i/w),0],[Math.exp(c/w),Math.exp(-c/w),0,e/w*Math.exp(c/w)-n/w*Math.exp(-c/w)],[1/w*Math.exp(i/w),-1/w*Math.exp(-i/w),e/w**2*Math.exp(i/w)+n/w**2*Math.exp(-i/w)+v/l,0],[1/w*Math.exp(c/w),-1/w*Math.exp(-c/w),0,e/w**2*Math.exp(c/w)+n/w**2*Math.exp(-c/w)-F/l]],x=solveLinearSystem(M,d.map(t=>-t));H=H.map((t,e)=>t+x[e]),console.log(`第 ${t} 次迭代: c1 = ${H[0]}, c2 = ${H[1]}, x_Ho = ${H[2]}, x_Hi = ${H[3]}`)}if(!O){const t=document.getElementById("first-phase-result");t&&(t.innerHTML=`\n            <h2 style="color: red">计算未收敛</h2>\n            <pre>经过 ${k} 次迭代仍未达到收敛条件\n请尝试:\n            1. 增加最大迭代次数\n            2. 调整初始猜测值\n            3. 检查输入参数合理性\n            </pre> `),firstPhaseConverged=!1;const e=document.getElementById("second-phase-result");if(e)return void(e.innerHTML='\n                <h2 style="color: red">警告</h2>\n                <pre>第一阶段计算结果未收敛，无法进行第二阶段计算！</pre>')}firstPhaseConverged=!0,console.log("最终解:"),console.log(`c1 = ${H[0]}`),console.log(`c2 = ${H[1]}`),console.log(`x_Ho = ${H[2]}`),console.log(`x_Hi = ${H[3]}`);const q=-v*(f**2-H[2]**2)/(2*l)+(o*r-v/2+b)*(f-H[2])-s,T=F*(y**2-H[3]**2)/(2*l)+(o*r-F/2+L)*(y-H[3])+s,P=F*(g**2-H[3]**2)/(2*l)+(o*r-F/2+L)*(g-H[3])+s;console.log(`u_H1 = ${q}`),console.log(`u_H2 = ${T}`),console.log(`u_H3 = ${P}`),R.Left.push(q),R.Middle.push(T),R.Right.push(P);const z=document.getElementById("first-phase-result");z&&(z.innerHTML=`\n\t\t\t<h2>第一阶段计算结果(单位: m)</h2>\n\t\t\t<pre>\n\t\t\t收敛于第 ${S} 次迭代\n\n\t\t\t第1次循环加热最终解:\n\t\t\tc1 = ${H[0]}\n\t\t\tc2 = ${H[1]}\n\t\t\tx_Ho = ${H[2]}\n\t\t\tx_Hi = ${H[3]}\n\n\t\t\t第1次循环加热位移结果:\n\t\t\tu_H1 = ${q.toFixed(8)}\n\t\t\tu_H2 = ${T.toFixed(8)}\n\t\t\tu_H3 = ${P.toFixed(8)}\n\t\t\t</pre> `),firstPhaseResults={c1:H[0],c2:H[1],x_Ho:H[2],x_Hi:H[3],u_H1:q,u_H2:T,u_H3:P,theta:a,mu:n,delta_e:s,alpha:o,T:r,T_c:i,w:h,L:l,E:c,A:u,Ft:p,Fb:m,x1:f,x2:y,x3:g,keypointdisps:R},calculateSecondPhase(firstPhaseResults)}function calculateSecondPhase(t){if(!t||!firstPhaseConverged){const t=document.getElementById("second-phase-result");return void(t&&(t.innerHTML='\n            <h2 style="color: red">警告</h2>\n            <pre>第一阶段计算结果未收敛，请检查输入参数或调整初始值！</pre>'))}const{c1:e,c2:a,x_Ho:n,x_Hi:s,u_H1:o,u_H2:r,u_H3:i,theta:h,mu:l,delta_e:c,alpha:u,T:p,T_c:m,w:_,L:d,E:M,A:x,Ft:f,Fb:y,x1:g,x2:H,x3:C,keypointdisps:w}=t,b=l*_*Math.cos(h)/c,L=Math.sqrt(M*x/b),v=f/(M*x),F=y/(M*x),E=(l*_*Math.cos(h)+_*Math.sin(h))*d/(M*x),k=(l*_*Math.cos(h)-_*Math.sin(h))*d/(M*x),O=_*d*Math.sin(h)+y-f,S=l*_*d*Math.cos(h)/(M*x),R=(l*_*d*Math.cos(h)-O)/(M*x),q=[],T=5,P={x1:g,x2:H,x3:C,lambda:L,alpha:u,T_c:m,omega:S,omega_plus:E,omega_minus:k,ft:v,fb:F,delta_e:c,L:d,R:R,T:p};let z={x_Ho:n,x_Hi:s,u_Cho:0,u_Chi:c,u_H1:o,u_H2:r,u_H3:i,phase:"第1次循环加热",type:"heating"},A=calculateCoolingPhase(P,z,phaseNumber=1);q.push(A),w.Left.push(A.u_C1),w.Middle.push(A.u_C2),w.Right.push(A.u_C3);for(let t=2;t<=T;t++)z=calculateHeatingPhase(P,A,phaseNumber=t),q.push(z),w.Left.push(o),w.Middle.push(r),w.Right.push(i),A=calculateCoolingPhase(P,z,phaseNumber=t),q.push(A),w.Left.push(A.u_C1),w.Middle.push(A.u_C2),w.Right.push(A.u_C3);displayPhaseResults(q);var I=keypoints_series(T,w,"位移");EchartOptionList.keypointdisp=Echart_Option("echart_walking","关键点位移","循环数","位移(m)",I),$("select#echart").change()}function calculateCoolingPhase(t,e,a){const{x1:n,x2:s,x3:o,lambda:r,alpha:i,T_c:h,omega:l,omega_plus:c,omega_minus:u,ft:p,fb:m,delta_e:_,L:d,R:M,T:x}=t,{x_Ho:f,x_Hi:y,u_Cho:g,u_Chi:H,u_H1:C,u_H2:w,u_H3:b,phase:L,type:$}=e,v=.5*d*(1-i*x/l+1/l*Math.sqrt(Math.pow(2*_/r,2)+Math.pow(i*x-M,2))),F=v-r*Math.log(Math.sqrt(Math.pow(2*_/(r*(i*x-M)),2)+1)+2*_/(r*(i*x-M))),E=(Math.exp(-F/r),Math.exp(F/r),u*(Math.pow(F,2)-Math.pow(y,2))/(2*d)+(i*x-u/2+m)*(F-y)+H),k=u*(Math.pow(v,2)-Math.pow(y,2))/(2*d)+(i*x-u/2+m)*(v-y)+H,O=u/(2*d)*(Math.pow(n,2)-Math.pow(F,2))+(i*h+u/2+p)*(n-F)+E,S=u/(2*d)*(Math.pow(s,2)-Math.pow(F,2))+(i*h+u/2+p)*(s-F)+E,R=-c/(2*d)*(Math.pow(o,2)-Math.pow(v,2))+(i*h+c/2+m)*(o-v)+k-2*_;return{x_Co:v,x_Ci:F,u_Hci:E,u_Hco:k,u_C1:O,u_C2:S,u_C3:R,phase:`第${a}次循环冷却`,type:"cooling"}}function calculateHeatingPhase(t,e,a){const{x1:n,x2:s,x3:o,lambda:r,alpha:i,T_c:h,omega:l,omega_plus:c,omega_minus:u,ft:p,fb:m,delta_e:_,L:d,R:M,T:x}=t,{x_Co:f,x_Ci:y,u_Hci:g,u_Hco:H,u_C1:C,u_C2:w,u_C3:b,phase:L,type:$}=e,v=.5*-d*(1-i*x/l+1/l*Math.sqrt(Math.pow(2*_/r,2)+Math.pow(i*x-M,2))),F=v+r*Math.log(Math.sqrt(Math.pow(2*_/(r*(i*x-M)),2)+1)+2*_/(r*(i*x-M))),E=(Math.exp(-F/r),Math.exp(F/r),u/(2*d)*(Math.pow(v,2)-Math.pow(y,2))+(i*h+u/2+p)*(v-y)+g),k=u/(2*d)*(Math.pow(F,2)-Math.pow(y,2))+(i*h+u/2+p)*(F-y)+g,O=-c/(2*d)*(Math.pow(n,2)-Math.pow(v,2))+(i*x-c/2+p)*(n-v)+E-2*_,S=u/(2*d)*(Math.pow(s,2)-Math.pow(F,2))+(i*x-u/2+m)*(s-F)+k,R=u/(2*d)*(Math.pow(o,2)-Math.pow(F,2))+(i*x-u/2+m)*(o-F)+k;return{x_Ho:v,x_Hi:F,u_Cho:E,u_Chi:k,u_H1:O,u_H2:S,u_H3:R,phase:`第${a}次循环加热`,type:"heating"}}function displayPhaseResults(t){let e="<h2>第二阶段计算结果(单位: m)</h2><pre>";t.forEach(t=>{e+=`\n${t.phase}位移结果:\n`,"heating"===t.type?(e+=`u_H1 = ${t.u_H1.toFixed(8)}\n`,e+=`u_H2 = ${t.u_H2.toFixed(8)}\n`,e+=`u_H3 = ${t.u_H3.toFixed(8)}\n`):(e+=`u_C1 = ${t.u_C1.toFixed(8)}\n`,e+=`u_C2 = ${t.u_C2.toFixed(8)}\n`,e+=`u_C3 = ${t.u_C3.toFixed(8)}\n`)}),e+="</pre>";const a=document.getElementById("second-phase-result");a&&(a.innerHTML=e)}function solveLinearSystem(t,e){const a=t.length;for(let n=0;n<a;n++){let s=n;for(let e=n+1;e<a;e++)Math.abs(t[e][n])>Math.abs(t[s][n])&&(s=e);[t[n],t[s]]=[t[s],t[n]],[e[n],e[s]]=[e[s],e[n]];for(let s=n+1;s<a;s++){const o=t[s][n]/t[n][n];e[s]-=o*e[n];for(let e=n;e<a;e++)t[s][e]-=o*t[n][e]}}const n=new Array(a).fill(0);for(let s=a-1;s>=0;s--){n[s]=e[s]/t[s][s];for(let a=s-1;a>=0;a--)e[a]-=t[a][s]*n[s]}return n}var ECharts=[],EchartOptionList=[],myChart=echarts.init(document.getElementById("echart_walking"));$("select#echart").on("change",function(t){switch(t.target.value){case"resistancesoil":EchartOptionList.resistancesoil&&(myChart.clear(),myChart.setOption(EchartOptionList.resistancesoil));break;case"N":EchartOptionList.N&&(myChart.clear(),myChart.setOption(EchartOptionList.N));break;case"strain":EchartOptionList.strain&&(myChart.clear(),myChart.setOption(EchartOptionList.strain));break;case"disp":EchartOptionList.disp&&(myChart.clear(),myChart.setOption(EchartOptionList.disp));break;case"keypointdisp":EchartOptionList.keypointdisp&&(myChart.clear(),myChart.setOption(EchartOptionList.keypointdisp));break;case"keypointN":EchartOptionList.keypointN&&(myChart.clear(),myChart.setOption(EchartOptionList.keypointN));break;case"keypointstrain":EchartOptionList.keypointstrain&&(myChart.clear(),myChart.setOption(EchartOptionList.keypointstrain))}}),$(window).resize(t=>{myChart.resize()});